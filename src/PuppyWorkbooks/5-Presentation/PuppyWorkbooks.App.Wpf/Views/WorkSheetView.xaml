<reactiveUi:ReactiveUserControl x:TypeArguments="viewModels:WorkSheetViewModel"
                                x:Class="PuppyWorkbooks.App.Wpf.Views.WorkSheetView"
                                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                xmlns:local="clr-namespace:PuppyWorkbooks.App.Wpf.Views"
                                xmlns:viewModels="clr-namespace:PuppyWorkbooks.ViewModels;assembly=PuppyWorkbooks.ViewModels"
                                xmlns:reactiveUi="http://reactiveui.net"
                                xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
                                mc:Ignorable="d"
                                d:DesignHeight="500" d:DesignWidth="800"
                                Height="Auto" Width="Auto"
                                d:DataContext="{d:DesignInstance viewModels:WorkSheetViewModel}">
    <UserControl.Resources>
        <!-- DataTemplate for each row -->
        
        <Storyboard x:Key="SlideInStoryboard">
            <DoubleAnimation Storyboard.TargetName="PanelTransform" Storyboard.TargetProperty="X" From="360" To="0"
                             Duration="0:0:0.3" AccelerationRatio="0.2" DecelerationRatio="0.8" />
        </Storyboard>
        <Storyboard x:Key="SlideOutStoryboard">
            <DoubleAnimation Storyboard.TargetName="PanelTransform" Storyboard.TargetProperty="X" From="0" To="360"
                             Duration="0:0:0.2" AccelerationRatio="0.3" DecelerationRatio="0.7" />
        </Storyboard>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />

        <!-- Sample data for quick preview -->
        <x:Array x:Key="SampleFormulas" Type="{x:Type sys:Object}" xmlns:sys="clr-namespace:System;assembly=mscorlib"> <!-- Each item is an anonymous-ish object via Tagging with Tuple-like properties if you want to bind later. For now, use explicit type: we’ll fake with simple objects via x:StaticResource approach, but for design-time we can just use composite bindings directly in the template text. --> </x:Array>
    </UserControl.Resources>
    <Grid Background="{StaticResource ShellBackgroundBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- Top app bar -->
        <DockPanel Grid.Row="0" Margin="{StaticResource PageMargin}">
            <TextBlock Text="Formulas" FontSize="26" FontWeight="SemiBold"
                       Foreground="{StaticResource HeaderForegroundBrush}" VerticalAlignment="Center"
                       DockPanel.Dock="Left" />
            <Button Style="{StaticResource AddButtonStyle}" x:Name="AddCellBtn"
                    DockPanel.Dock="Right" Margin="12,0,0,0" />
            
            <Button Content="Run All"
                    x:Name="RunAllBtn"
                    FontWeight="SemiBold"
                    Background="#2563EB"
                    Foreground="White"
                    Padding="10"
                    BorderBrush="Transparent"
                    HorizontalAlignment="Stretch"
                    Cursor="Hand" 
                    Margin="16,0,4,0"
            />
        </DockPanel>
        <!-- List of formulas -->
            <ListView Grid.Row="1" Grid.Column="0" 
                      ItemsSource="{Binding Cells}"
                      SelectedItem="{Binding SelectedFormula, Mode=TwoWay}"
                      Margin="{StaticResource PageMargin}"
                      ScrollViewer.VerticalScrollBarVisibility="Auto" d:ItemsSource="{d:SampleData ItemCount=5}">
            <ListView.ItemTemplate>
                <DataTemplate DataType="viewModels:WorkCellViewModel">
                    <local:WorkCellView></local:WorkCellView>
                </DataTemplate>
            </ListView.ItemTemplate>
                <!-- <ItemsControl.ItemsSource> -->
                <!--     <x:Array Type="{x:Type viewModels:WorkCellViewModel}" -->
                <!--              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"> -->
                <!--         <viewModels:WorkCellViewModel Name="Quadratic Formula" Formula="x = (-b ± √(b² - 4ac)) / 2a" -->
                <!--                                       Comments="Solutions of ax² + bx + c = 0" Result="-1, -0.5" /> -->
                <!--         <viewModels:WorkCellViewModel Name="Pythagorean Theorem" Formula="a² + b² = c²" -->
                <!--                                       Comments="Right-angled triangles" Result="5" /> -->
                <!--         <viewModels:WorkCellViewModel Name="Area of a Circle" Formula="A = πr²" Comments="r = radius" -->
                <!--                                       Result="153.9" /> -->
                <!--         <viewModels:WorkCellViewModel Name="Euler's Formula" Formula="e^(iπ) + 1 = 0" -->
                <!--                                       Comments="Relation to complex exponentials" Result="0" /> -->
                <!--     </x:Array> -->
                <!-- </ItemsControl.ItemsSource> -->
            </ListView>
        <ScrollViewer Grid.Row="1" Grid.Column="1" x:Name="EditPanelHost"
              
              HorizontalAlignment="Stretch"
              Visibility="{Binding SelectedFormula, Converter={StaticResource NullToVisibilityConverter}}"
              VerticalAlignment="Stretch"
              RenderTransformOrigin="0.5,0.5">
            <ScrollViewer.RenderTransform>
                <TranslateTransform x:Name="PanelTransform" X="360" />
            </ScrollViewer.RenderTransform>
            <!-- Your edit panel goes here -->
            <Border Grid.Row="0" Background="#F3F7FB"
                    
                    Padding="24"
                    CornerRadius="12"
                    BorderBrush="#D0E2FF"
                    BorderThickness="1"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    SnapsToDevicePixels="True"
                    Effect="{StaticResource PanelShadowEffect}">
                <!-- StackPanel with fields and Save button -->
                <StackPanel VerticalAlignment="Top" Margin="0,12,0,0"> <!-- Panel Title -->
                    <DockPanel Margin="0,0,0,24">
                        <TextBlock Text="Edit Formula" FontSize="20" FontWeight="SemiBold" Foreground="#222" />
                        <Button Content="✕" Width="32" Height="32" FontSize="16" FontWeight="Bold"
                                Background="Transparent"
                                Foreground="#444" BorderBrush="Transparent" HorizontalAlignment="Right"
                                VerticalAlignment="Center" Cursor="Hand" />
                    </DockPanel> <!-- Name Field -->
                    <TextBlock Text="Name" FontSize="14" Foreground="#555" Margin="0,0,0,4" />
                    <TextBox Text="{Binding SelectedFormula.Name}" FontSize="14" Padding="8" Background="White"
                             BorderBrush="#CCC" BorderThickness="1" Margin="0,0,0,16" />
                    <!-- Formula Field -->
                    <TextBlock Text="Formula" FontSize="14" Foreground="#555" Margin="0,0,0,4" />
                    <!-- XAML -->
                    <syncfusion:EditControl
                        Text="{Binding SelectedFormula.Formula, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        BorderThickness="1"
                        Margin="0,0,0,16"
                        Padding="8"
                        Height="Auto"
                        MinHeight="80"
                        MaxHeight="200"
                        VerticalAlignment="Top"
                        VerticalContentAlignment="Stretch"
                        AcceptsReturn="True"
                        VerticalScrollBarVisibility="Auto" />

                    <!-- <TextBox Text="{Binding SelectedFormula.Formula}" FontSize="14" Padding="8" Background="White" -->
                    <!--          BorderBrush="#CCC" BorderThickness="1" AcceptsReturn="True" -->
                    <!--          TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" -->
                    <!--          Margin="0,0,0,16" /> -->
                    <!-- Comments Field -->
                    <TextBlock Text="Comments" FontSize="14" Foreground="#555" Margin="0,0,0,4" />
                    <TextBox Text="{Binding SelectedFormula.Comments}" FontSize="14" Padding="8" Background="White"
                             BorderBrush="#CCC" BorderThickness="1" Margin="0,0,0,16"
                             AcceptsReturn="True" VerticalScrollBarVisibility="Auto"
                             TextWrapping="Wrap" /> <!-- Result Field -->
                    <TextBlock Text="Result" FontSize="14" Foreground="#555" Margin="0,0,0,4" />
                    <TextBox Text="{Binding SelectedFormula.Result}" FontSize="14" Padding="8" Background="White"
                             BorderBrush="#CCC" BorderThickness="1" Margin="0,0,0,24"
                             AcceptsReturn="True" VerticalScrollBarVisibility="Auto" TextWrapping="Wrap" Height="auto"
                             IsReadOnly="True" />
                    <!-- Save Button -->
                    <!-- Remove Button -->
                    <Button x:Name="DeleteSelectedBtn"
                            Content="Remove" FontSize="15" FontWeight="SemiBold" Background="#D92C2C"
                            Foreground="White" Padding="10" BorderBrush="Transparent"
                            HorizontalAlignment="Stretch" Cursor="Hand" 
                            
                            />
                    <Button Content="Run"
                            
                            x:Name="RunSelectedBtn"
                            FontSize="15"
                            FontWeight="SemiBold"
                            Background="#2563EB"
                            Foreground="White"
                            Padding="10"
                            BorderBrush="Transparent"
                            HorizontalAlignment="Stretch"
                            Cursor="Hand" 
                            />

                </StackPanel>
            </Border>
        </ScrollViewer>
    </Grid>
</reactiveUi:ReactiveUserControl>